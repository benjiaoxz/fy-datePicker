!function(t){try{t.$=$}catch(t){throw"js库必须为Zepto或jQuery"}var e={dateBase:"",gather:[],disableSwitch:!1,lock:!1,multiple:!0,before:!1,after:2,weekend:!1,selectCallback:null,highlight:!0},a=function(t,r){a.data={base:{year:"",month:"",day:"",week:""},selectData:[]},a.el=t?$(t):$(this),"object"==typeof r&&(r.gather&&("object"!=typeof r.gather||r.gather instanceof Array||(r.gather=[r.gather])),$.extend(e,r)),a.init.call(this)};a.init=function(){if(""!==e.dateBase)var t=a.formatDate(e.dateBase);else var r=new Date,t={year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()};a.data.base={year:t.year,month:t.month,day:t.day,week:t.week};var n=a.data.base;this.full(n)},a.prototype.full=function(t){function r(t,e){var r=!1;if(e instanceof Array){var n={},o="",d="";try{e.forEach(function(e,h){if(o=a.formatDate(e.date),d=a.formatDate(t),o.day==d.day&&o.month==d.month&&o.year==d.year)throw r=h,n})}catch(t){if(t!=n)throw t}}else if("string"==typeof e){var o=a.formatDate(t),d=a.formatDate(e);o.day==d.day&&o.month==d.month&&o.year==d.year&&(r=!0)}return r}function n(){var t=$(this);if(e.multiple)if(t.data("confirm")){t.data("confirm",!1),t.removeClass("active");for(var n=0;n<ot.length;n++)r(ot[n].date,t.data("date"))&&ot.splice(n,1)}else t.data("confirm",!0),t.addClass("active"),o(t.data("date"),t.data("comment"));else{if(t.data("confirm"))return;$("[data-selectable=true]").removeClass("active").data("confirm",!1),t.data("confirm",!0),t.addClass("active"),ot.length=0,o(t.data("date"),t.data("comment"))}e.selectCallback instanceof Function&&e.selectCallback.call(a.el,a.data)}function o(t,e){var r=a.formatDate(t);ot.push({date:r,comment:e})}if("string"==typeof t)var d=a.formatDate(t);else{if("object"!=typeof t)throw"参数错误";var d=t}var h=$('<div class="fy-date-picker">'),i=$('<div class="head">');if(""==e.dateBase)var s="disabled",c="disabled",l="",f="";else{var g,m,y=a.formatDate(e.dateBase);y.month,y.day;g=m=d.year+"-"+(d.month>=10?d.month:"0"+d.month)+"-"+(d.day>=10?d.day:"0"+d.day),g=new Date(g+"T00:00:01"),m=new Date(m+"T00:00:02"),g.setMonth(g.getMonth()-1),m.setMonth(m.getMonth()+1);var u=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate(),b=m.getFullYear()+"-"+(m.getMonth()+1)+"-"+m.getDate(),s="",c="",l='data-target-month="'+u+'"',f='data-target-month="'+b+'"',v=a.createDate(y),p=new Date(g.toDateString()),D=new Date(m.toDateString());e.after<0?(p.setMonth(p.getMonth()+1+Math.abs(e.after))<v.getTime()&&(s="disabled",l=""),D.setMonth(D.getMonth())>v.getTime()&&(c="disabled",f="")):e.after>0&&(p.setMonth(p.getMonth()+1)<v.getTime()&&(s="disabled",l=""),D.setMonth(D.getMonth()-Math.abs(e.after))>v.getTime()&&(c="disabled",f="")),0==e.after&&(s="disabled",l="",c="disabled",f="")}var w="",k="";e.disableSwitch||(w+='<div class="left-btn '+s+'" '+l+">上个月</div>",k+='<div class="right-btn '+c+'" '+f+">下个月</div>");var M=w+'<div class="date">'+d.year+"年"+d.month+"月</div>"+k;h.append(i.append(M));var j=$('<table cellspacing="0" border="0" class="section">');j.append("<thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead>");for(var T=$("<tbody></tbody>"),C="",x=new Date(d.year,d.month-1,1),P=x.getDay(),B=new Date(d.year,d.month,0),F=B.getDate(),O=B.getDay(),A=[],S=1;S<=F;S++)A.push(S);if(0!==P)for(var S=0;S<P;S++)A.unshift("");if(6!==O)for(var S=0;S<6-O;S++)A.push("");for(var Y=[],S=0;S<e.gather.length;S++)e.gather[S].comment&&Y.push({date:e.gather[S].date,text:e.gather[S].comment});for(var E=a.formatComment(d.year+"-"+d.month,Y),I="",Q="",Z="",q="",z="",G="",H="",J="",K="",L="",N="",R="",U="",V=[],W=[],X=[],_=[],tt=[],et=null,S=0;S<e.gather.length;S++){if(e.gather[S].state)switch(et={date:e.gather[S].date,comment:e.gather[S].comment},e.gather[S].state){case"select":W.push(et);break;case"readonly":X.push(et);break;case"disable":_.push(et);break;case"active":tt.push(et),a.data.selectData.indexOf(et)<0&&a.data.selectData.push(et)}e.gather[S]["badge-left"]?(R=e.gather[S]["badge-left"],e.gather[S]["badge-left-active"]&&(U=e.gather[S]["badge-left-active"]),V.push({date:e.gather[S].date,badge:{direction:"left",source:R,active:U}})):e.gather[S]["badge-right"]&&(R=e.gather[S]["badge-right"],e.gather[S]["badge-right-active"]&&(U=e.gather[S]["badge-right-active"]),V.push({date:e.gather[S].date,badge:{direction:"right",source:R,active:U}}))}for(var S=0;S<A.length;S++){K=function(t){var e="";return E instanceof Array?E.forEach(function(r){a.formatDate(r.date).day==t&&(e=r.text)}):"object"==typeof E&&a.formatDate(E.date).day==t&&(e=E.text),e}(A[S]),L=S%7==0,N=(S+1)%7==0,q='data-date="'+d.year+"-"+d.month+"-"+A[S]+'" ',z="<p>"+A[S]+"</p>",G='data-comment="'+K+'"',H='<span class="comment">'+K+"</span>",I="",Q="",Z="";var at="";if(""==A[S])q="",z="",G="",H="",I="",Q="",Z="";else{e.before||A[S]<d.day&&(I=" readonly",Q="",Z=""),e.weekend||(L||N)&&(I=" disabled");var rt=d.year+"-"+d.month+"-"+A[S];r(rt,W)?(I="",Q='data-confirm="false" ',Z='data-selectable="true" '):r(rt,tt)?(I=" active",Q='data-confirm="true" ',Z='data-selectable="true" '):(Q="",Z="",r(rt,_)?I=" disabled":r(rt,X)&&(I=" readonly"));var nt=r(rt,V);nt&&(at='<div class="badge" style="'+V[nt].badge.direction+": 0; background-image: url("+V[nt].badge.source+');"></div>')}""!=A[S]&&r(d.year+"-"+d.month+"-"+A[S],a.data.selectData)&&(I=" active",Q='data-confirm="true" ',Z='data-selectable="true" '),e.highlight&&""!=$.trim(K)&&(I+=" highlight");J+='<td class="'+$.trim(I)+'" '+Q+Z+q+G+">"+at+z+H+"</td>"}if(C+="<tr>"+J+"</tr>",T.append(C),h.append(j.append(T)),a.el.html("").append(h),!e.lock){var ot=a.data.selectData;$("[data-selectable=true]").on("click",n);var dt=this;$("[data-target-month]").on("click",function(){var t=$(this);dt.full(t.data("target-month"))})}},a.formatDate=function(t){var e=null;if("string"==typeof t){for(var a=t.split("-"),r="",n=0;n<a.length;n++)a[n]<10&&(a[n]="0"+a[n]),n<a.length-1?r+=a[n]+"-":r+=a[n];2==a.length?r+="-01T00:00:00":r+="T00:00:00";try{var o=new Date(r);switch(e={year:o.getFullYear(),month:o.getMonth()+1,day:o.getDate()},o.getDay()){case 0:e.week="星期日";break;case 1:e.week="星期一";break;case 2:e.week="星期二";break;case 3:e.week="星期三";break;case 4:e.week="星期四";break;case 5:e.week="星期五";break;case 6:e.week="星期六"}}catch(t){throw"日期错误"}}else"object"==typeof t&&t.hasOwnProperty("year")&&t.hasOwnProperty("month")&&t.hasOwnProperty("day")&&t.hasOwnProperty("week")&&(e=t);return e},a.createDate=function(t){var e=null;if("object"==typeof t)e=new Date(t.year+"-"+(t.month>=10?t.month:"0"+t.month)+"-"+(t.day>=10?t.day:"0"+t.day)+"T00:00:01");else if("string"==typeof t){var a=t.split("-");e=new Date(a[0]+"-"+(parseInt(a[1])>=10?a[1]:"0"+a[1])+"-"+(parseInt(a[2])>=10?a[2]:"0"+a[2])+"T00:00:01")}return e},a.formatComment=function(t,e){function r(e){if(e.date&&e.text){var r=a.formatDate(t),n=a.formatDate(e.date);if(r.year==n.year&&r.month==n.month)return e}return!1}if(e instanceof Array){var n=[];if(e.forEach(function(t){r(t)&&n.push(t)}),n.length>0)return n}else if("object"==typeof e)return r(e);return!1};var r=function(t){return this.each(function(){if("object"==typeof t||!t)return new a(this,t)})};$.fn.datePicker=r,$.fn.datePicker.constructor=a}(window);