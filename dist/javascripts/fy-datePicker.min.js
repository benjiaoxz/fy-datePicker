!function(e){try{e.$=$}catch(e){throw"js库必须为Zepto或jQuery"}var t={dateBase:"",gather:[],disableSwitch:!1,lock:!1,multiple:!0,before:!1,after:2,weekend:!1,selectCallback:null,highlight:!0},a=function(e,r){a.data={base:{year:"",month:"",day:"",week:""},selectData:[]},a.el=e?$(e):$(this),"object"==typeof r&&(r.gather&&("object"!=typeof r.gather||r.gather instanceof Array||(r.gather=[r.gather])),$.extend(t,r)),a.init.call(this)};a.init=function(){if(""!==t.dateBase)var e=a.formatDate(t.dateBase);else var r=new Date,e={year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()};a.data.base={year:e.year,month:e.month,day:e.day,week:e.week};var n=a.data.base;this.full(n)},a.prototype.full=function(e){function r(e,t){var r=!1,n={},o="",d="";try{t.forEach(function(t){if(o=a.formatDate(t.date),d=a.formatDate(e),o.day==d.day&&o.month==d.month&&o.year==d.year)throw r=!0,n})}catch(e){if(e!=n)throw e}return r}function n(){var e=$(this);if(t.multiple)if(e.data("confirm")){e.data("confirm",!1),e.removeClass("active");for(var r=0;r<W.length;r++)W[r].date==e.data("date")&&W.splice(r,1)}else e.data("confirm",!0),e.addClass("active"),o(e.data("date"),e.data("comment"));else{if(e.data("confirm"))return;$("[data-selectable=true]").removeClass("active").data("confirm",!1),e.data("confirm",!0),e.addClass("active"),W.length=0,o(e.data("date"),e.data("comment"))}t.selectCallback instanceof Function&&t.selectCallback.call(a.el,a.data)}function o(e,t){var r=a.formatDate(e);W.push({date:r,comment:t})}if("string"==typeof e)var d=a.formatDate(e);else{if("object"!=typeof e)throw"参数错误";var d=e}var h=$('<div class="fy-date-picker">'),i=$('<div class="head">');if(""==t.dateBase)var s="disabled",c="disabled",l="",f="";else{var m=a.formatDate(t.dateBase),y=m.month,u=m.day;if(1==d.month)var v=d.year-1+"-12";else if(d.month-1==y)var v=d.year+"-"+y+"-"+u;else var v=d.year+"-"+(d.month-1);if(12==d.month)var p=d.year+1+"-1";else if(d.month+1==y)var p=d.year+"-"+y+"-"+u;else var p=d.year+"-"+(d.month+1);var s="",c="",l='data-target-month="'+v+'"',f='data-target-month="'+p+'"';"number"==typeof t.after&&(t.after<0?d.month-1<y+t.after?(s="disabled",l=""):d.month+1>y&&(c="disabled",f=""):t.after>0?d.month-1<y?(s="disabled",l=""):d.month>y+(t.after-1)&&(c="disabled",f=""):(s="disabled",l="",c="disabled",f=""))}var b="",g="";t.disableSwitch||(b+='<div class="left-btn '+s+'" '+l+">上个月</div>",g+='<div class="right-btn '+c+'" '+f+">下个月</div>");var w=b+'<div class="date">'+d.year+"年"+d.month+"月</div>"+g;h.append(i.append(w));var k=$('<table cellspacing="0" border="0" class="section">');k.append("<thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead>");for(var D=$("<tbody></tbody>"),j="",C=new Date(d.year,d.month-1,1),x=C.getDay(),P=new Date(d.year,d.month,0),B=P.getDate(),O=P.getDay(),A=[],E=1;E<=B;E++)A.push(E);if(0!==x)for(var E=0;E<x;E++)A.unshift("");if(6!==O)for(var E=0;E<6-O;E++)A.push("");for(var F=[],E=0;E<t.gather.length;E++)t.gather[E].comment&&F.push({date:t.gather[E].date,text:t.gather[E].comment});for(var M=a.formatComment(d.year+"-"+d.month,F),S="",T="",Y="",Q="",Z="",q="",z="",G="",H="",I="",J="",K=[],L=[],N=[],R=[],U=null,E=0;E<t.gather.length;E++)if(t.gather[E].state)switch(U={date:t.gather[E].date,comment:t.gather[E].comment},t.gather[E].state){case"select":K.push(U);break;case"readonly":L.push(U);break;case"disable":N.push(U);break;case"active":R.push(U),a.data.selectData.indexOf(U)<0&&a.data.selectData.push(U)}for(var E=0;E<A.length;E++){if(H=function(e){var t="";return M instanceof Array?M.forEach(function(r){a.formatDate(r.date).day==e&&(t=r.text)}):"object"==typeof M&&a.formatDate(M.date).day==e&&(t=M.text),t}(A[E]),I=E%7==0,J=(E+1)%7==0,Q='data-date="'+d.year+"-"+d.month+"-"+A[E]+'" ',Z="<p>"+A[E]+"</p>",q='data-comment="'+H+'"',z='<span class="comment">'+H+"</span>",S="",T="",Y="",""==A[E])Q="",Z="",q="",z="",S="",T="",Y="";else{t.before||A[E]<d.day&&(S=" readonly",T="",Y=""),t.weekend||(I||J)&&(S=" disabled");var V=d.year+"-"+d.month+"-"+A[E];r(V,K)?(S="",T='data-confirm="false" ',Y='data-selectable="true" '):r(V,R)?(S=" active",T='data-confirm="true" ',Y='data-selectable="true" '):(T="",Y="",r(V,N)?S=" disabled":r(V,L)&&(S=" readonly"))}""!=A[E]&&r(d.year+"-"+d.month+"-"+A[E],a.data.selectData)&&(S=" active",T='data-confirm="true" ',Y='data-selectable="true" '),t.highlight&&""!=$.trim(H)&&(S+=" highlight"),S=$.trim(S),G+='<td class="'+S+'" '+T+Y+Q+q+">"+Z+z+"</td>"}if(j+="<tr>"+G+"</tr>",D.append(j),h.append(k.append(D)),a.el.html("").append(h),!t.lock){var W=a.data.selectData;$("[data-selectable=true]").on("click",n);var X=this;$("[data-target-month]").on("click",function(){var e=$(this);X.full(e.data("target-month"))})}},a.formatDate=function(e){var t=null;if("string"==typeof e){for(var a=e.split("-"),r="",n=0;n<a.length;n++)a[n]<10&&(a[n]="0"+a[n]),n<a.length-1?r+=a[n]+"-":r+=a[n];2==a.length?r+="-01T00:00:00":r+="T00:00:00";try{var o=new Date(r);switch(t={year:o.getFullYear(),month:o.getMonth()+1,day:o.getDate()},o.getDay()){case 0:t.week="星期日";break;case 1:t.week="星期一";break;case 2:t.week="星期二";break;case 3:t.week="星期三";break;case 4:t.week="星期四";break;case 5:t.week="星期五";break;case 6:t.week="星期六"}}catch(e){throw"日期错误"}}else"object"==typeof e&&e.hasOwnProperty("year")&&e.hasOwnProperty("month")&&e.hasOwnProperty("day")&&e.hasOwnProperty("week")&&(t=e);return t},a.formatComment=function(e,t){function r(t){if(t.date&&t.text){var r=a.formatDate(e),n=a.formatDate(t.date);if(r.year==n.year&&r.month==n.month)return t}return!1}if(t instanceof Array){var n=[];if(t.forEach(function(e){r(e)&&n.push(e)}),n.length>0)return n}else if("object"==typeof t)return r(t);return!1};var r=function(e){return this.each(function(){if("object"==typeof e||!e)return new a(this,e)})};$.fn.datePicker=r,$.fn.datePicker.constructor=a}(window);