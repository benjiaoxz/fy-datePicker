!function(e){try{e.$=$}catch(e){throw"js库必须为Zepto或jQuery"}var t={dateBase:"",gather:[],disableSwitch:!1,lock:!1,multiple:!0,before:!1,after:2,weekend:!1,selectCallback:null,highlight:!0},a=function(e,r){a.data={base:{year:"",month:"",day:"",week:""},selectData:[]},a.el=e?$(e):$(this),"object"==typeof r&&(r.gather&&("object"!=typeof r.gather||r.gather instanceof Array||(r.gather=[r.gather])),$.extend(t,r)),a.init.call(this)};a.init=function(){if(""!==t.dateBase)var e=a.formatDate(t.dateBase);else var r=new Date,e={year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()};a.data.base={year:e.year,month:e.month,day:e.day,week:e.week};var n=a.data.base;this.full(n)},a.prototype.full=function(e){function r(e,t){var r=!1;if(t instanceof Array){var n={},d="",o="";try{t.forEach(function(t,i){if(d=a.formatDate(t.date),o=a.formatDate(e),d.day==o.day&&d.month==o.month&&d.year==o.year)throw r=i.toString(),n})}catch(e){if(e!=n)throw e}}else if("string"==typeof t){var d=a.formatDate(e),o=a.formatDate(t);d.day==o.day&&d.month==o.month&&d.year==o.year&&(r=!0)}return r}function n(){var e=$(this),n=e.find(".badge");if(t.multiple)if(e.data("confirm")){e.data("confirm",!1),e.removeClass("active");for(var o=0;o<de.length;o++)r(de[o].date,e.data("date"))&&de.splice(o,1);1==n.length&&n.css({"background-image":"url("+n.data("badge")+")"})}else e.data("confirm",!0),e.addClass("active"),d(e.data("date"),e.data("comment")),1==n.length&&n.css({"background-image":"url("+n.data("badge-active")+")"});else{if(e.data("confirm"))return;$("[data-selectable=true]").each(function(e,t){$(this).removeClass("active").data("confirm",!1),$(this).find(".badge").css({"background-image":"url("+$(this).find(".badge").data("badge")+")"})}),e.data("confirm",!0),e.addClass("active"),de.length=0,d(e.data("date"),e.data("comment")),n.css({"background-image":"url("+n.data("badge-active")+")"})}t.selectCallback instanceof Function&&t.selectCallback.call(a.el,a.data)}function d(e,t){var r=a.formatDate(e);de.push({date:r,comment:t})}if("string"==typeof e)var o=a.formatDate(e);else{if("object"!=typeof e)throw"参数错误";var o=e}var i=$('<div class="fy-date-picker">'),h=$('<div class="head">');if(""==t.dateBase)var s="disabled",c="disabled",l="",f="";else{var g,m,u=a.formatDate(t.dateBase);u.month,u.day;g=m=o.year+"-"+(o.month>=10?o.month:"0"+o.month)+"-"+(o.day>=10?o.day:"0"+o.day),g=new Date(g+"T00:00:01"),m=new Date(m+"T00:00:02"),g.setMonth(g.getMonth()-1),m.setMonth(m.getMonth()+1);var b=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate(),y=m.getFullYear()+"-"+(m.getMonth()+1)+"-"+m.getDate(),s="",c="",l='data-target-month="'+b+'"',f='data-target-month="'+y+'"',v=a.createDate(u),p=new Date(g.toDateString()),D=new Date(m.toDateString());t.after<0?(p.setMonth(p.getMonth()+1+Math.abs(t.after))<v.getTime()&&(s="disabled",l=""),D.setMonth(D.getMonth())>v.getTime()&&(c="disabled",f="")):t.after>0&&(p.setMonth(p.getMonth()+1)<v.getTime()&&(s="disabled",l=""),D.setMonth(D.getMonth()-Math.abs(t.after))>v.getTime()&&(c="disabled",f="")),0==t.after&&(s="disabled",l="",c="disabled",f="")}var w="",k="";t.disableSwitch||(w+='<div class="left-btn '+s+'" '+l+">上个月</div>",k+='<div class="right-btn '+c+'" '+f+">下个月</div>");var M=w+'<div class="date">'+o.year+"年"+o.month+"月</div>"+k;i.append(h.append(M));var j=$('<table cellspacing="0" border="0" class="section">');j.append("<thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead>");for(var T=$("<tbody></tbody>"),C="",x=new Date(o.year,o.month-1,1),P=x.getDay(),B=new Date(o.year,o.month,0),F=B.getDate(),O=B.getDay(),S=[],A=1;A<=F;A++)S.push(A);if(0!==P)for(var A=0;A<P;A++)S.unshift("");if(6!==O)for(var A=0;A<6-O;A++)S.push("");for(var Y=[],A=0;A<t.gather.length;A++)t.gather[A].comment&&Y.push({date:t.gather[A].date,text:t.gather[A].comment});for(var E=a.formatComment(o.year+"-"+o.month,Y),I="",Q="",Z="",q="",z="",G="",H="",J="",K="",L="",N="",R="",U="",V=[],W=[],X=[],_=[],ee=[],te=null,A=0;A<t.gather.length;A++){if(t.gather[A].state)switch(te={date:t.gather[A].date,comment:t.gather[A].comment},t.gather[A].state){case"select":W.push(te);break;case"readonly":X.push(te);break;case"disable":_.push(te);break;case"active":ee.push(te),a.data.selectData.indexOf(te)<0&&a.data.selectData.push(te)}t.gather[A]["badge-left"]?(R=t.gather[A]["badge-left"],t.gather[A]["badge-left-active"]&&(U=t.gather[A]["badge-left-active"]),V.push({date:t.gather[A].date,badge:{direction:"left",source:R,active:U}})):t.gather[A]["badge-right"]&&(R=t.gather[A]["badge-right"],t.gather[A]["badge-right-active"]&&(U=t.gather[A]["badge-right-active"]),V.push({date:t.gather[A].date,badge:{direction:"right",source:R,active:U}}))}for(var A=0;A<S.length;A++){K=function(e){var t="";return E instanceof Array?E.forEach(function(r){a.formatDate(r.date).day==e&&(t=r.text)}):"object"==typeof E&&a.formatDate(E.date).day==e&&(t=E.text),t}(S[A]),L=A%7==0,N=(A+1)%7==0,q='data-date="'+o.year+"-"+o.month+"-"+S[A]+'" ',z="<p>"+S[A]+"</p>",G='data-comment="'+K+'"',H='<span class="comment">'+K+"</span>",I="",Q="",Z="";var ae="";if(""==S[A])q="",z="",G="",H="",I="",Q="",Z="";else{t.before||S[A]<o.day&&(I=" readonly",Q="",Z=""),t.weekend||(L||N)&&(I=" disabled");var re=o.year+"-"+o.month+"-"+S[A];r(re,W)?(I="",Q='data-confirm="false" ',Z='data-selectable="true" '):r(re,ee)?(I=" active",Q='data-confirm="true" ',Z='data-selectable="true" '):(Q="",Z="",r(re,_)?I=" disabled":r(re,X)&&(I=" readonly"));var ne=r(re,V);ne&&(ae='<div class="badge" style="'+V[ne].badge.direction+": 0; background-image: url("+V[ne].badge.source+');"data-badge="'+V[ne].badge.source+'"data-badge-active="'+V[ne].badge.active+'"></div>')}""!=S[A]&&r(o.year+"-"+o.month+"-"+S[A],a.data.selectData)&&(I=" active",Q='data-confirm="true" ',Z='data-selectable="true" '),t.highlight&&""!=$.trim(K)&&(I+=" highlight");J+='<td class="'+$.trim(I)+'" '+Q+Z+q+G+">"+ae+z+H+"</td>"}if(C+="<tr>"+J+"</tr>",T.append(C),i.append(j.append(T)),a.el.html("").append(i),!t.lock){var de=a.data.selectData;$("[data-selectable=true]").on("click",n);var oe=this;$("[data-target-month]").on("click",function(){var e=$(this);oe.full(e.data("target-month"))})}},a.formatDate=function(e){var t=null;if("string"==typeof e){for(var a=e.split("-"),r="",n=0;n<a.length;n++)a[n]<10&&(a[n]="0"+a[n]),n<a.length-1?r+=a[n]+"-":r+=a[n];2==a.length?r+="-01T00:00:00":r+="T00:00:00";try{var d=new Date(r);switch(t={year:d.getFullYear(),month:d.getMonth()+1,day:d.getDate()},d.getDay()){case 0:t.week="星期日";break;case 1:t.week="星期一";break;case 2:t.week="星期二";break;case 3:t.week="星期三";break;case 4:t.week="星期四";break;case 5:t.week="星期五";break;case 6:t.week="星期六"}}catch(e){throw"日期错误"}}else"object"==typeof e&&e.hasOwnProperty("year")&&e.hasOwnProperty("month")&&e.hasOwnProperty("day")&&e.hasOwnProperty("week")&&(t=e);return t},a.createDate=function(e){var t=null;if("object"==typeof e)t=new Date(e.year+"-"+(e.month>=10?e.month:"0"+e.month)+"-"+(e.day>=10?e.day:"0"+e.day)+"T00:00:01");else if("string"==typeof e){var a=e.split("-");t=new Date(a[0]+"-"+(parseInt(a[1])>=10?a[1]:"0"+a[1])+"-"+(parseInt(a[2])>=10?a[2]:"0"+a[2])+"T00:00:01")}return t},a.formatComment=function(e,t){function r(t){if(t.date&&t.text){var r=a.formatDate(e),n=a.formatDate(t.date);if(r.year==n.year&&r.month==n.month)return t}return!1}if(t instanceof Array){var n=[];if(t.forEach(function(e){r(e)&&n.push(e)}),n.length>0)return n}else if("object"==typeof t)return r(t);return!1};var r=function(e){return this.each(function(){if("object"==typeof e||!e)return new a(this,e)})};$.fn.datePicker=r,$.fn.datePicker.constructor=a}(window);