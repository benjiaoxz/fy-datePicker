!function(e){try{e.$=$}catch(e){throw"js库必须为Zepto或jQuery"}var t={dateBase:"",gather:[],disableSwitch:!1,lock:!1,multiple:!0,before:!1,after:2,weekend:!1,selectCallback:null},a=function(e,r){a.data={base:{year:"",month:"",day:"",week:""},selectData:[]},a.el=e?$(e):$(this),"object"==typeof r&&(r.gather&&("object"!=typeof r.gather||r.gather instanceof Array||(r.gather=[r.gather])),$.extend(t,r)),a.init.call(this)};a.init=function(){if(""!==t.dateBase)var e=a.formatDate(t.dateBase);else var r=new Date,e={year:r.getFullYear(),month:r.getMonth()+1,day:r.getDate()};a.data.base={year:e.year,month:e.month,day:e.day,week:e.week};var n=a.data.base;this.full(n)},a.prototype.full=function(e){function r(e,t){var r=!1,n={},o="",i="";try{t.forEach(function(t){if(o=a.formatDate(t.date),i=a.formatDate(e),o.day==i.day&&o.month==i.month&&o.year==i.year)throw r=!0,n})}catch(e){if(e!=n)throw e}return r}function n(){var e=$(this);if(e.data("confirm")){e.data("confirm",!1),e.removeClass("active");for(var r=0;r<V.length;r++)V[r].date==e.data("date")&&V.splice(r,1);t.multiple||$("[data-selectable=true]").on("click",n)}else{if(!t.multiple&&1==V.length)return!1;e.data("confirm",!0),e.addClass("active"),V.push({date:e.data("date"),comment:e.data("comment")}),t.multiple||($("[data-selectable=true]").off("click"),e.one("click",n))}t.selectCallback instanceof Function&&t.selectCallback.call(a.el,a.data)}if("string"==typeof e)var o=a.formatDate(e);else{if("object"!=typeof e)throw"参数错误";var o=e}var i=$('<div class="fy-date-picker">'),l=$('<div class="head">');if(""==t.dateBase)var c="disabled",d="disabled",s="",h="";else{var f=a.formatDate(t.dateBase),m=f.month,u=f.day;if(1==o.month)var y=o.year-1+"-12";else if(o.month-1==m)var y=o.year+"-"+m+"-"+u;else var y=o.year+"-"+(o.month-1);if(12==o.month)var v=o.year+1+"-1";else if(o.month+1==m)var v=o.year+"-"+m+"-"+u;else var v=o.year+"-"+(o.month+1);var c="",d="",s='data-target-month="'+y+'"',h='data-target-month="'+v+'"';"number"==typeof t.after&&(t.after<0?o.month-1<m+t.after?(c="disabled",s=""):o.month+1>m&&(d="disabled",h=""):t.after>0?o.month-1<m?(c="disabled",s=""):o.month>m+(t.after-1)&&(d="disabled",h=""):(c="disabled",s="",d="disabled",h=""))}var b="",p="";t.disableSwitch||(b+='<div class="left-btn '+c+'" '+s+">上个月</div>",p+='<div class="right-btn '+d+'" '+h+">下个月</div>");var g=b+'<div class="date">'+o.year+"年"+o.month+"月</div>"+p;i.append(l.append(g));var k=$('<table cellspacing="0" border="0" class="section">');k.append("<thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead>");for(var w=$("<tbody></tbody>"),D="",j=new Date(o.year,o.month-1,1),C=j.getDay(),N=new Date(o.year,o.month,0),x=N.getDate(),B=N.getDay(),F=[],A=1;A<=x;A++)F.push(A);if(0!==C)for(var A=0;A<C;A++)F.unshift("");if(6!==B)for(var A=0;A<6-B;A++)F.push("");for(var E=[],A=0;A<t.gather.length;A++)t.gather[A].comment&&E.push({date:t.gather[A].date,text:t.gather[A].comment});for(var M=a.formatComment(o.year+"-"+o.month,E),Y="",P="",S="",Q="",Z="",q="",z="",G="",H="",I="",J="",K=[],L=[],O=[],R=[],T=null,A=0;A<t.gather.length;A++)if(t.gather[A].state)switch(T={date:t.gather[A].date,comment:t.gather[A].comment},t.gather[A].state){case"select":K.push(T);break;case"readonly":L.push(T);break;case"disable":O.push(T);break;case"active":R.push(T)}for(var A=0;A<F.length;A++){if(H=function(e){var t="";return M instanceof Array?M.forEach(function(r){a.formatDate(r.date).day==e&&(t=r.text)}):"object"==typeof M&&a.formatDate(M.date).day==e&&(t=M.text),t}(F[A]),I=A%7==0,J=(A+1)%7==0,Q='data-date="'+o.year+"-"+o.month+"-"+F[A]+'" ',Z="<p>"+F[A]+"</p>",q='data-comment="'+H+'"',z='<span class="comment">'+H+"</span>",""==F[A])Q="",Z="",q="",z="",Y="",P="",S="";else{t.before||F[A]<o.day&&(Y=" readonly",P="",S=""),t.weekend||(I||J)&&(Y=" disabled");var U=o.year+"-"+o.month+"-"+F[A];r(U,K)?(Y="",P='data-confirm="false" ',S='data-selectable="true" '):r(U,R)?(Y=" active",P='data-confirm="true" ',S='data-selectable="true" '):(P="",S="",Y=r(U,O)?" disabled":" readonly")}r(o.year+"-"+o.month+"-"+F[A],a.data.selectData)&&(Y=" active",P='data-confirm="true" ',S='data-selectable="true" '),G+='<td class="'+Y+'" '+P+S+Q+q+">"+Z+z+"</td>"}if(D+="<tr>"+G+"</tr>",w.append(D),i.append(k.append(w)),a.el.html("").append(i),!t.lock){var V=a.data.selectData;$("[data-selectable=true]").on("click",n);var W=this;$("[data-target-month]").on("click",function(){var e=$(this);W.full(e.data("target-month"))})}},a.formatDate=function(e){var t=null;if("string"==typeof e){var a=e.split("-");if(2==a.length)var r=new Date(a[0],a[1]);else{if(3!=a.length)throw"日期错误";var r=new Date(a[0],a[1],a[2])}if(isNaN(r.getFullYear())||isNaN(r.getMonth())||isNaN(r.getDate()))throw"日期错误";switch(t={year:r.getFullYear(),month:r.getMonth(),day:r.getDate()},r.getDay()){case 0:t.week="星期日";break;case 1:t.week="星期一";break;case 2:t.week="星期二";break;case 3:t.week="星期三";break;case 4:t.week="星期四";break;case 5:t.week="星期五";break;case 6:t.week="星期六"}}return t},a.formatComment=function(e,t){function r(t){if(t.date&&t.text){var r=a.formatDate(e),n=a.formatDate(t.date);if(r.year==n.year&&r.month==n.month)return t}return!1}if(t instanceof Array){var n=[];if(t.forEach(function(e){r(e)&&n.push(e)}),n.length>0)return n}else if("object"==typeof t)return r(t);return!1};var r=function(e){return this.each(function(){if("object"==typeof e||!e)return new a(this,e)})};$.fn.datePicker=r,$.fn.datePicker.constructor=a}(window);